/*! For license information please see onx-service-content-email.js.LICENSE.txt */
(()=>{"use strict";var e={320:function(e){var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;e.exports=!function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var o=Object.getOwnPropertyNames(t).map(function(e){return t[e]});if("0123456789"!==o.join(""))return!1;var r={};if("abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},r)).join(""))return!1;return!0}catch(e){return!1}}()?function(e,r){for(var i,a,l=function(e){if(null==e)throw TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),s=1;s<arguments.length;s++){for(var d in i=Object(arguments[s]))n.call(i,d)&&(l[d]=i[d]);if(t){a=t(i);for(var c=0;c<a.length;c++)o.call(i,a[c])&&(l[a[c]]=i[a[c]])}}return l}:Object.assign},837:function(e,t,n){n(320);var o=n(644),r=60103;if(t.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var i=Symbol.for;r=i("react.element"),t.Fragment=i("react.fragment")}var a=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l=Object.prototype.hasOwnProperty,s={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,n){var o,i={},d=null,c=null;for(o in void 0!==n&&(d=""+n),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)l.call(t,o)&&!s.hasOwnProperty(o)&&(i[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===i[o]&&(i[o]=t[o]);return{$$typeof:r,type:e,key:d,ref:c,props:i,_owner:a.current}}t.jsx=d,t.jsxs=d},322:function(e,t,n){e.exports=n(837)},644:function(e){e.exports=react}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.rv=()=>"1.2.7",n.ruid="bundler=rspack@1.2.7",(()=>{var e=n(644),t=n.n(e);let o=react-dom;var r=n.n(o);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){var o,r,i;o=e,r=t,i=n[t],r in o?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){var n;if("function"!=typeof(n=t.domElement?function(){return t.domElement}:t.domElementGetter?t.domElementGetter:e.domElementGetter?e.domElementGetter:function(e){var t=e.appName||e.name;if(!t)throw Error("single-spa's dom-element-getter-helpers was not given an application name as a prop, so it can't make a unique dom element container for the react application");var n="single-spa-application:".concat(t);return function(){var e=document.getElementById(n);return e||((e=document.createElement("div")).id=n,document.body.appendChild(e)),e}}(t)))throw Error("single-spa's dom-element-getter-helpers was given an invalid domElementGetter for application or parcel '".concat(t.name,"'. Expected a function, received ").concat(s(n)));return function(){var e=n(t);if(!(e instanceof HTMLElement))throw Error("single-spa's dom-element-getter-helpers: domElementGetter returned an invalid dom element for application or parcel '".concat(t.name,"'. Expected HTMLElement, received ").concat(s(e)));return e}}var c=null;try{c=require("react").createContext()}catch(e){}var u={React:null,ReactDOM:null,rootComponent:null,loadRootComponent:null,renderType:null,errorBoundary:null,errorBoundaryClass:null,domElementGetter:null,parcelCanUpdate:!0,suppressComponentDidCatchWarning:!1,domElements:{},renderResults:{},updateResolves:{}};function m(e,t){return e.rootComponent?Promise.resolve():e.loadRootComponent(t).then(function(t){e.rootComponent=t})}function p(e,t){return new Promise(function(n,o){e.suppressComponentDidCatchWarning||!function(e){if(!(e&&"string"==typeof e.version&&e.version.indexOf(".")>=0))return!1;var t=e.version.slice(0,e.version.indexOf("."));try{return Number(t)>=16}catch(e){return!1}}(e.React)||e.errorBoundary||(e.rootComponent.prototype?e.rootComponent.prototype.componentDidCatch||console.warn("single-spa-react: ".concat(t.name||t.appName||t.childAppName,"'s rootComponent should implement componentDidCatch to avoid accidentally unmounting the entire single-spa application.")):console.warn("single-spa-react: ".concat(t.name||t.appName||t.childAppName,"'s rootComponent does not implement an error boundary.  If using a functional component, consider providing an opts.errorBoundary to singleSpaReact(opts).")));var r=h(e,t,function(){n(this)}),i=d(e,t)(),a=function(e){var t=e.opts,n=e.elementToRender,o=e.domElement,r="function"==typeof t.renderType?t.renderType():t.renderType;if(["createRoot","unstable_createRoot","createBlockingRoot","unstable_createBlockingRoot"].indexOf(r)>=0){var i=t.ReactDOM[r](o);return i.render(n),i}return"hydrate"===r?t.ReactDOM.hydrate(n,o):t.ReactDOM.render(n,o),null}({elementToRender:r,domElement:i,opts:e});e.domElements[t.name]=i,e.renderResults[t.name]=a})}function f(e,t){return new Promise(function(n){e.unmountFinished=n;var o=e.renderResults[t.name];o&&o.unmount?o.unmount():e.ReactDOM.unmountComponentAtNode(e.domElements[t.name]),delete e.domElements[t.name],delete e.renderResults[t.name]})}function v(e,t){return new Promise(function(n){e.updateResolves[t.name]||(e.updateResolves[t.name]=[]),e.updateResolves[t.name].push(n);var o=h(e,t,null),r=e.renderResults[t.name];if(r&&r.render)r.render(o);else{var i=d(e,t)();e.ReactDOM.render(o,i)}})}function h(e,t,n){var o=e.React.createElement(e.rootComponent,t),r=c?e.React.createElement(c.Provider,{value:t},o):o;return(e.errorBoundary||t.errorBoundary||e.errorBoundaryClass||t.errorBoundaryClass)&&(e.errorBoundaryClass=e.errorBoundaryClass||t.errorBoundaryClass||function(e,t){function n(t){e.React.Component.apply(this,arguments),this.state={caughtError:null,caughtErrorInfo:null},n.displayName="SingleSpaReactErrorBoundary(".concat(t.name,")")}return n.prototype=Object.create(e.React.Component.prototype),n.prototype.render=function(){return this.state.caughtError?(e.errorBoundary||t.errorBoundary)(this.state.caughtError,this.state.caughtErrorInfo,this.props):this.props.children},n.prototype.componentDidCatch=function(e,t){this.setState({caughtError:e,caughtErrorInfo:t})},n}(e,t),r=e.React.createElement(e.errorBoundaryClass,t,r)),r=e.React.createElement(e.SingleSpaRoot,a(a({},t),{},{mountFinished:n,updateFinished:function(){e.updateResolves[t.name]&&(e.updateResolves[t.name].forEach(function(e){return e()}),delete e.updateResolves[t.name])},unmountFinished:function(){setTimeout(e.unmountFinished)}}),r)}var y=n(322);let g=lodash;var x=n.n(g);let b={truncString:(e,t,n)=>(n=n||"...","string"==typeof e&&e.length>t?e.substring(0,t)+n:e),toHHMMSS(e){let t=parseInt(e,10);return[Math.floor(t/3600),Math.floor(t/60)%60,t%60].map(e=>e<10?"0"+e:e).filter((e,t)=>"00"!==e||t>0).join(":")}},w=window.Antd,j=window.axios.default,{DownOutlined:E,WarningOutlined:S,SyncOutlined:_,UpOutlined:C,PictureOutlined:R,FileOutlined:O,DownloadOutlined:N}=window.AntdIcon,{bootstrap:B,mount:k,unmount:T}=function(e){if("object"!==l(e))throw Error("single-spa-react requires a configuration object");var t=a(a({},u),e);if(!t.React)throw Error("single-spa-react must be passed opts.React");if(!t.ReactDOM)throw Error("single-spa-react must be passed opts.ReactDOM");if(!t.rootComponent&&!t.loadRootComponent)throw Error("single-spa-react must be passed opts.rootComponent or opts.loadRootComponent");if(t.errorBoundary&&"function"!=typeof t.errorBoundary)throw Error("The errorBoundary opt for single-spa-react must either be omitted or be a function that returns React elements");!c&&t.React.createContext&&(c=t.React.createContext()),t.SingleSpaRoot=function(e){function t(e){t.displayName="SingleSpaRoot(".concat(e.name,")")}return t.prototype=Object.create(e.React.Component.prototype),t.prototype.componentDidMount=function(){setTimeout(this.props.mountFinished)},t.prototype.componentWillUnmount=function(){setTimeout(this.props.unmountFinished)},t.prototype.render=function(){return setTimeout(this.props.updateFinished),this.props.children},t}(t);var n={bootstrap:m.bind(null,t),mount:p.bind(null,t),unmount:f.bind(null,t)};return t.parcelCanUpdate&&(n.update=v.bind(null,t)),n}({React:t(),ReactDOM:r(),rootComponent:function(e){let[n,o]=t().useState(e.interactionActive),[r,i]=t().useState([]),[a,l]=t().useState("now"),[s,d]=t().useState(1),[c,u]=t().useState(!1),[m,p]=t().useState(!1),[f,v]=t().useState(!1),[h,g]=t().useState(null),[B,k]=t().useState(""),[T,I]=t().useState(!1),[A,D]=t().useState(e.showAside),[M,P]=t().useState(!0),[H,L]=t().useState(null),[$,F]=t().useState(0),U=e.getStorage("setting",!0),z=e.getStorage("settingAI",!0),G=U.filter(e=>"use_ai"===e.key&&1===parseInt(e.value1)),q=e=>{p(!0),j.post(`/AI/agentAssist/${null==n?void 0:n.session_id}`,{text:e}).then(e=>{L(e.data),p(!1),Q()}).catch(()=>p(!1))};t().useEffect(()=>{window.Emitter.on("interactionActive",e=>o(e)),window.Emitter.on("loading_message",e=>u(e)),window.Emitter.on("showAside",e=>D(e)),window.Emitter.on("scrollBottom",()=>{Y("refresh"),setTimeout(()=>{Y("now")},200)})},[]),t().useEffect(()=>{if(n){var t,o;W(0,1,null==n?void 0:n.session_id,null===(o=e.channels)||void 0===o?void 0:null===(t=o.filter(e=>parseInt(e.id)===parseInt(null==n?void 0:n.channel_id))[0])||void 0===t?void 0:t.code,(null==n?void 0:n.date_end)||e.isLog?"history":"now"),Y("refresh"),setTimeout(()=>{Y("now")},200)}return window.Emitter.on("syncEmail",()=>{var t,o;W(0,1,null==n?void 0:n.session_id,null===(o=e.channels)||void 0===o?void 0:null===(t=o.filter(e=>parseInt(e.id)===parseInt(null==n?void 0:n.channel_id))[0])||void 0===t?void 0:t.code,(null==n?void 0:n.date_end)||e.isLog?"history":"now"),Y("refresh"),setTimeout(()=>{Y("now")},200)}),()=>{window.Emitter.off("syncEmail",null)}},[n]);let Y=e=>{let t=document.getElementById("body-rtc");if(t){let n=new window.PerfectScrollbar(t,{suppressScrollX:!0});"now"===e&&(t.scrollTop=t.scrollHeight-t.clientHeight),"refresh"===e&&(t.scrollTop=0),n.update()}},W=function(){var t,o;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null==n?void 0:n.sessionId,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null===(o=e.channels)||void 0===o?void 0:null===(t=o.filter(e=>parseInt(e.id)===parseInt(null==n?void 0:n.channel_id))[0])||void 0===t?void 0:t.code,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a;l(p);let f="string"==typeof r?parseInt(r):r,v="string"==typeof c?parseInt(c):c;window.Emitter.emit("loading_message",!0);let h=`getInteractionBySession?session_id=${u}&limit=10&page=${v+f}&interaction_type=${p}`;j.get(`/service/${m}/${h}`).then(t=>{if(window.Emitter.emit("loading_message",!1),d(v+f),t){let n=x().uniqBy(x().orderBy(t.data,["date_origin","asc"]),null);i(n),(null==e?void 0:e.isLog)&&window.Emitter.emit("interactionMessageHistory",n)}}).catch(()=>{window.Emitter.emit("loading_message",!1)})},J=(e,t)=>{let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){let e=(window.URL||window.webkitURL).createObjectURL(this.response),n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)},n.send()},X=e=>{e?P(!0):P(!1)},Q=()=>{var t;j.get(`/AI/checkQuotaAiSession/${null===(t=e.interactionActive)||void 0===t?void 0:t.session_id}/summarize_email`).then(e=>{var t;F(null===(t=e.data)||void 0===t?void 0:t.quota)}).catch(()=>u(!1))};return t().useEffect(()=>{var e;G.length>0&&(null==z?void 0:null===(e=z.filter(e=>"summarize_email"===e.key)[0])||void 0===e?void 0:e.value)&&Q()},[]),(0,y.jsx)(w.ConfigProvider,{theme:{token:{colorPrimary:window.BASE_THEME.palette.primary.main,colorLink:window.BASE_THEME.palette.primary.dark,colorLinkHover:window.BASE_THEME.palette.primary.dark,wireframe:!1}},children:(0,y.jsx)("div",{className:"h-full relative",id:"body-rtc",children:(0,y.jsx)("div",{className:"relative z-10 flex-grow flex-shrink basis-0 order-2 h-full py-2.5 px-5 flex flex-col",id:"room-body",children:c?(0,y.jsxs)("div",{className:"flex flex-col h-full items-center",children:[(0,y.jsx)(w.Skeleton,{loading:c,active:!0}),(0,y.jsx)(w.Skeleton,{loading:c,active:!0}),(0,y.jsx)(w.Skeleton,{loading:c,active:!0})]}):(0,y.jsxs)(y.Fragment,{children:[r.length>0?r.map((e,t)=>{var o,a,l,s,d;return(0,y.jsx)("div",{className:"mb-2.5",children:(0,y.jsxs)(w.Card,{bodyStyle:{padding:0},children:[(0,y.jsxs)(w.Row,{gutter:[12,12],className:"p-2.5 items-center",children:[(0,y.jsx)(w.Col,{xs:0,sm:0,md:0,lg:A?3:2,xl:A?3:2,children:(0,y.jsx)(w.Avatar,{className:"bg-[#fcebbb] text-[#f5b449]",size:"large",children:(null===(o=e.from_name)||void 0===o?void 0:o.charAt(0).toUpperCase())||"-"})}),(0,y.jsx)(w.Col,{span:17,children:(0,y.jsxs)("div",{className:"flex flex-col",children:[(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("div",{className:"font-bold text-[12px] mr-[5px]",children:e.from_name}),(0,y.jsx)("div",{className:"text-[#89A2B8] text-[12px]",children:"IN"===e.action_type?`<${e.from_id}>`:""})]}),(0,y.jsxs)("div",{className:"text-[#8C8C8C] text-[10px]",children:["To :"," ",(null==e?void 0:e.to_email)?JSON.parse(null==e?void 0:e.to_email).map(e=>e.name?e.name:e.address).join(","):"-"]}),(0,y.jsxs)("div",{className:"text-[#8C8C8C] text-[10px] break-all",children:["Cc :"," ",(null==e?void 0:e.cc_email)?JSON.parse(null==e?void 0:e.cc_email).map(e=>e.name?e.name:e.address).join(","):"-"]})]})}),(0,y.jsxs)(w.Col,{xs:6,sm:6,md:6,lg:A?4:5,xl:A?4:5,children:[(0,y.jsx)("div",{className:"w-full flex justify-end",children:(0,y.jsx)(w.Switch,{className:"mb-2.5",defaultChecked:!0,size:"small",checkedChildren:"HTML",unCheckedChildren:"RAW",onChange:X})}),(0,y.jsx)("div",{className:"text-[#BFBFBF] text-[10px] text-right",children:e.date_received?window.moment.unix(e.date_received).format("DD/MM/YYYY HH:mm"):"Sent"})]})]}),(0,y.jsxs)("div",{className:"flex items-center justify-between mb-2.5 py-0 px-2.5",children:[(0,y.jsx)("div",{className:"text-[14px] text-[#8C8C8C]",children:e.subject?e.subject:"No subject"}),(0,y.jsx)(w.Tooltip,{title:T!==e.id?"Show detail email":"Hide detail",children:(0,y.jsx)(w.Button,{disabled:f,type:"text",shape:"circle",icon:f?(0,y.jsx)(_,{spin:!0}):T===e.id?(0,y.jsx)(C,{}):(0,y.jsx)(E,{}),id:"show-detail-email",onClick:()=>{if(T===e.id)I(!1),k(""),g(!1);else{let t=window.axios.default;v(!0),L(!1),t.get(`/service/email/body/${e.id}`).then(t=>{I(e.id),k(t.data),v(!1)}).catch(()=>v(!1))}}})})]}),B&&T===e.id?(0,y.jsxs)("div",{className:"w-full flex justify-between",children:[(0,y.jsxs)("div",{className:"w-[90%] mb-2.5 p-2.5",children:[(0,y.jsx)("div",{className:"w-full overflow-auto mb-2.5",children:M?(0,y.jsx)("div",{className:"mb-2.5",dangerouslySetInnerHTML:{__html:null==B?void 0:null===(a=B.toString())||void 0===a?void 0:a.replace(/<style[\s\S]*?>[\s\S]*?<\/style>/gi,"")}}):(0,y.jsx)("div",{children:null==B?void 0:B.toString()})}),(null===(l=e.attachment)||void 0===l?void 0:l.length)>0?e.attachment.map((t,o)=>(0,y.jsx)(w.Card,{className:"w-full overflow-auto mb-2.5",bodyStyle:{padding:10},children:(0,y.jsxs)("div",{className:"flex gap-1 items-center",children:[t.content_type.indexOf("image")>-1?(0,y.jsx)(R,{}):(0,y.jsx)(O,{}),(0,y.jsx)("div",{className:"text-[12px] ml-2.5",children:b.truncString(t.file_name,30,"...")}),(0,y.jsx)("div",{className:"ml-auto",children:(0,y.jsx)(w.Tooltip,{title:"Download file",children:(0,y.jsx)(w.Button,{disabled:h===t.content_id,type:"text",shape:"circle",icon:h===t.content_id?(0,y.jsx)(_,{spin:!0}):(0,y.jsx)(N,{}),id:"download-email",onClick:()=>{g(t.content_id),fetch(t.url).then(o=>{200===o.status?(g(!1),J(t.url,t.file_name)):window.axios.default.put("/service/email/generateNewUrl",{interaction_id:e.id,interaction_type:(null==n?void 0:n.date_end)?"history":"now",token:t.token}).then(e=>{if(e){var n,o;g(!1),J(null===(o=e.data)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.url,t.file_name)}})})}})})})]})},o)):null]}),(0,y.jsx)("div",{className:"w-[10%] p-2.5",children:(null==G?void 0:G.length)>0&&(null==z?void 0:null===(s=z.filter(e=>"summarize_email"===e.key)[0])||void 0===s?void 0:s.value)?(0,y.jsx)("div",{children:(0,y.jsx)(w.Tooltip,{title:(null==e?void 0:e.disabledAI)?(0,y.jsx)("div",{children:"You've reached your daily limit on this session"}):(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{children:"Generate Summarize"}),(0,y.jsxs)("div",{className:"text-[12px] text-[#8A98AD] italic",children:["You just have ",$," time generate"]})]}),children:(0,y.jsx)(w.Button,{className:"bg-[#f1f5f8]",type:"default",disabled:m||(null==e?void 0:e.disabledAI),icon:(0,y.jsx)("img",{src:`${window.ASSET_URL}/images/icon_ai_color.svg?r=${new Date().getDate()}`,className:"w-[20px] h-full",alt:"Menu"}),id:"ai-summarize-email",onClick:()=>{var e;r[t].disabledAI=!0,i([...r]),q(null==B?void 0:null===(e=B.toString())||void 0===e?void 0:e.replace(/<\/?[^>]+(>|$)/g,""))}})})}):null})]}):null,m&&T===e.id?(0,y.jsx)("div",{className:"flex justify-center p-2.5",children:(0,y.jsx)(w.Spin,{spinning:m})}):H&&T===e.id?(0,y.jsx)("div",{className:" flex p-2.5",children:(0,y.jsxs)("div",{className:"button",children:[(0,y.jsx)("img",{src:`${window.ASSET_URL}/images/icon_ai_color.svg?r=${new Date().getDate()}`,className:"w-[20px] h-full ml-2.5",alt:"Menu"}),(0,y.jsxs)("div",{className:"text-button",children:["AI Summary Highlight:"," ",(0,y.jsxs)("span",{className:"font-normal",children:['"',null===(d=H[0])||void 0===d?void 0:d.value,'"']})]})]})}):null,!1===e.send_status?(0,y.jsx)(w.Tooltip,{title:e.send_detail,children:(0,y.jsx)(w.Button,{className:"text-[10px]",size:"small",type:"text",danger:!0,icon:(0,y.jsx)(S,{}),children:"Interaction not sent"})}):null]})},t)}):null,(0,y.jsx)("div",{className:"p-2.5"})]})})})})},errorBoundary:()=>null})})()})();